version: "3.9"

services:
  shadowsocks:
    build: ./ss
    network_mode: "host"
    command: ["-s", "ss://AEAD_AES_256_GCM:password@:8388", "-udp", "-verbose"]
    restart: unless-stopped

  v2ray-vmess:
    image: v2fly/v2fly-core
    environment:
      - V2RAY_VMESS_AEAD_FORCED=false
    network_mode: "host"
    command: ["run", "-c", "/etc/v2ray/config.json"]
    volumes:
      - type: bind
        source: ./v2ray/config.json
        target: /etc/v2ray/config.json
      - type: bind
        source: ./v2ray/cert.pem
        target: /etc/v2ray/v2ray.crt
      - type: bind
        source: ./v2ray/key.pem
        target: /etc/v2ray/v2ray.key

  trojan:
    image: trojangfw/trojan
    network_mode: "host"
    volumes:
      - type: bind
        source: ./trojan/config.json
        target: /config/config.json
      - type: bind
        source: ./v2ray/cert.pem
        target: /etc/v2ray/v2ray.crt
      - type: bind
        source: ./v2ray/key.pem
        target: /etc/v2ray/v2ray.key

  nginx:
    build: ./nginx
    network_mode: "host"